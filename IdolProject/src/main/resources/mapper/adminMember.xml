<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
   <mapper namespace="AmemberDAO"> 
   
   		<!-- 맴버 전체 리스트 불러오기 가입일 기준으로 내림차순  -->
   		<select id="getMemberLsit" resultType="memberDTO">
   			select * from member order by member_join_date desc
   		</select>
   		
   		<!-- 문의 게시판 리스트 불러오기 -->
	   	<select id="getInquirList" resultType="inquiryDTO">
	   		select * from inquiry_board 
	   			order by inquiry_group, inquiry_step asc, inquiry_update, inquiry_date asc   
	   	</select>
   
   		<!-- 문의 게시판 카테고리 가져오기 -->
   		<select id="getInquiryCategoryList" resultType="iCategoryDTO">
   			select * from inquiry_category order by category_ino
   		</select>
   	
   		<!-- 문의 내용 상세 정보 가져오기 by inquiry_no -->
   		<select id="getInquiryCont" parameterType="int" resultType="inquiryDTO">
   			select * from inquiry_board where inquiry_no = #{no}
   		</select>
   
   		<select id="getOrderInfoByNo" parameterType="int" resultType="OrderDTO">
   			select * from order_product where order_no = #{no}
   		</select>
   		
   		<!-- 문의 답글 작성시 같은 그룹의 스탭들을 +1 시켜자  -->
   		<update id="updateReplyStep" parameterType="inquiryDTO">
   			update inquiry_board set inquiry_step = inquiry_step + 1 
   				where inquiry_group = #{inquiry_group} and inquiry_step > #{inquiry_step}
   		</update>
   		
   		<!-- 문의 답글 작성 -->
   		<insert id="insertInquiryReply" parameterType="inquiryDTO">
   			<selectKey resultType="int" keyProperty="inquiry_no" order="BEFORE">
   				select max(inquiry_no) from inquiry_board
   			</selectKey>
   			insert into inquiry_board values(#{inquiry_no} + 1, #{inquiry_userid}, #{inquiry_title}, 
   				#{inquiry_cont}, #{inquiry_image}, default, sysdate, '', #{product_no}, #{order_no}, 
   					#{inquiry_status}, #{inquiry_group}, #{inquiry_step} + 1, #{inquiry_indent} + 1, #{category_inofk} )
   		</insert>
   		
   		<!-- 문의 글 답변 완료시 status 1로 바꾸기 -->
   		<update id="updateReplyStatus" parameterType="inquiryDTO">
   			update inquiry_board set inquiry_status = #{inquiry_status} where inquiry_no = #{inquiry_no}
   		</update>
   
   		<!-- 문의 글 같은 그룹 리스트 불러오기 by inquiry_group -->
   		<select id="getInquiryReplyList" parameterType="int" resultType="inquiryDTO">
   			select * from inquiry_board where inquiry_group = #{no} order by inquiry_step asc
   		</select>
   
   </mapper> 
    